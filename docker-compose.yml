services:
  # Service principal Sama-Quete (monolithique)
  samaquete:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - NODE_ENV=production
    container_name: samaquete-app
    ports:
      - "${ADMIN_PORT:-3000}:3000"
      - "${PAYMENT_API_PORT:-3001}:3001"
    environment:
      # Firebase Configuration
      - FIREBASE_PROJECT_ID=${FIREBASE_PROJECT_ID}
      - FIREBASE_CLIENT_EMAIL=${FIREBASE_CLIENT_EMAIL}
      - FIREBASE_PRIVATE_KEY=${FIREBASE_PRIVATE_KEY}
      - NEXT_PUBLIC_FIREBASE_API_KEY=${NEXT_PUBLIC_FIREBASE_API_KEY}
      - NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=${NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN}
      - NEXT_PUBLIC_FIREBASE_PROJECT_ID=${NEXT_PUBLIC_FIREBASE_PROJECT_ID}
      - NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=${NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET}
      - NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=${NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID}
      - NEXT_PUBLIC_FIREBASE_APP_ID=${NEXT_PUBLIC_FIREBASE_APP_ID}
      
      # PayDunya Configuration
      - PAYDUNYA_MODE=${PAYDUNYA_MODE:-sandbox}
      - PAYDUNYA_MASTER_KEY=${PAYDUNYA_MASTER_KEY}
      - PAYDUNYA_PRIVATE_KEY=${PAYDUNYA_PRIVATE_KEY}
      - PAYDUNYA_TOKEN=${PAYDUNYA_TOKEN}
      - PAYDUNYA_MERCHANT_NAME=${PAYDUNYA_MERCHANT_NAME:-SAMA-QUETE}
      
      # Database (pour payment-api)
      - DATABASE_URL=${DATABASE_URL}
      - POSTGRES_URL=${POSTGRES_URL}
      
      # Base URLs
      - BASE_URL=${BASE_URL:-http://localhost:3001}
      - NEXT_PUBLIC_BASE_URL=${NEXT_PUBLIC_BASE_URL:-http://localhost:3001}
      - NEXT_PUBLIC_PAYMENT_API_URL=${NEXT_PUBLIC_PAYMENT_API_URL:-http://localhost:3001}
      
      # CORS (ajoutez votre IP locale pour Expo Go)
      - CORS_ORIGINS=${CORS_ORIGINS:-http://localhost:3000,http://localhost:3001,exp://*}
      
      # Node Environment
      - NODE_ENV=${NODE_ENV:-production}
      - PORT=3000
      - PAYMENT_API_PORT=3001
    volumes:
      # Montage optionnel pour le développement (commenté en production)
      # - ./samaquete-admin:/app/samaquete-admin
      # - ./payment-api:/app/payment-api
      - /app/node_modules
    restart: unless-stopped
    networks:
      - samaquete-network

  # Base de données PostgreSQL (optionnelle, si payment-api en a besoin)
  # Décommentez si vous n'utilisez pas une base de données externe
  # postgres:
  #   image: postgres:15-alpine
  #   container_name: samaquete-postgres
  #   environment:
  #     - POSTGRES_DB=${POSTGRES_DB:-samaquete}
  #     - POSTGRES_USER=${POSTGRES_USER:-samaquete}
  #     - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
  #   volumes:
  #     - postgres_data:/var/lib/postgresql/data
  #   ports:
  #     - "${POSTGRES_PORT:-5432}:5432"
  #   networks:
  #     - samaquete-network
  #   restart: unless-stopped

networks:
  samaquete-network:
    driver: bridge

# volumes:
#   postgres_data:

